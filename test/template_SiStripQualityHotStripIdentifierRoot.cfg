process ICALIB = {
    
    service = MessageLogger {
        untracked vstring destinations = { "cout" }
        untracked PSet cout = { untracked string threshold = "DEBUG" }
	#       untracked PSet cout = { untracked string threshold = "INFO" }
        untracked vstring debugModules   = { "*" }
	
    }


    source = EmptyIOVSource {
        string timetype = "runnumber"
        uint64 firstValue = insertRun
        uint64 lastValue = insertRun
        uint64 interval = 1
    }
    untracked PSet maxEvents = {untracked int32 input = 1}
    

    service = PoolDBOutputService{
        string connect = "sqlite_file:dbfile.db"
        untracked string timetype = "runnumber"
        untracked string BlobStreamerName="TBufferBlobStreamingService"
        PSet DBParameters = {
            untracked string authenticationPath="/afs/cern.ch/cms/DB/conddb"
        }
	VPSet toPut={ { string record = "SiStripBadStrip" string tag = "SiStripBadChannel_v1"} }
    }
    
    #########################
    # DQM services
    #########################
    include "DQMServices/Core/data/DQM.cfg"
        
    module prod =  SiStripQualityHotStripIdentifierRoot {
	
        //ConditionDBWriter parameters
        bool SinceAppendMode = true
        string IOVMode       = "Run"
        string Record        = "SiStripBadStrip"
        bool doStoreOnDB     = true
	
        untracked string rootFilename = "insertInputDQMfile"      #"DQM_V0001_SiStrip_R000067173.root"
# "/storage/data1/SiStrip/SiStripDQM/output/craft/DQM_V0001_SiStrip_R000069365_T00000404_5am-12am.root"
        untracked string rootDirPath = ""
        untracked uint32 verbosity =0
        //this module parameters
        #untracked FileInPath file = "CalibTracker/SiStripCommon/data/SiStripDetInfo.dat"

        PSet AlgoParameters = {
            string AlgoName= "SiStripHotStripAlgorithmFromClusterOccupancy"
            untracked double ProbabilityThreshold = 1.E-7
            untracked uint32 MinNumEntries = 0
            untracked uint32 MinNumEntriesPerStrip = 20
	    untracked double OccupancyThreshold = 1.E-4
	    untracked uint32 NumberOfEvents = 0
        }
	
	untracked uint32 OccupancyH_Nbin = 1001
	untracked double OccupancyH_Xmin = -0.0005
	untracked double OccupancyH_Xmax = 1
	untracked string OccupancyRootFile = "HotStripsOccupancy_insertRun.root"
    }
    
    path p = { prod }

    module print = AsciiOutputModule {}
    endpath ep = { print }
}

